<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆÙ‚Ø¹ Ù…ØµØ·ÙÙ‰ Ø­Ø³Ù† | Ø¹Ø§Ù„Ù…ÙŠ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ù†Ø´Ø±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .post-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 500px; margin-bottom: 20px; text-align: right; }
        .actions { display: flex; justify-content: space-between; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .like-btn { background: none; border: none; cursor: pointer; font-size: 16px; color: #65676b; }
        .like-btn.liked { color: #e41e3f; }
        .comments-section { margin-top: 15px; }
        .comment-input-area { display: flex; margin-bottom: 15px; }
        .comment-input-area input { flex-grow: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px 0 0 5px; }
        .comment-input-area button { padding: 10px; background-color: #1877f2; color: white; border: none; border-radius: 0 5px 5px 0; cursor: pointer; }
        .comment { background: #f7f7f7; padding: 8px 10px; border-radius: 15px; margin-bottom: 10px; font-size: 15px; line-height: 1.4; }
        .comment-author { font-weight: bold; color: #333; margin-left: 5px; }
    </style>
</head>
<body>

    <div class="post-card">
        <span class="author" style="font-weight: bold;">Ù…ØµØ·ÙÙ‰ Ø­Ø³Ù† (Ø§Ù„Ù…ÙÙƒØ±)</span>
        <p class="content">Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø±ÙØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹!</p>
        
        <div class="actions">
            <button id="likeButton" class="like-btn" onclick="toggleLike()">
                <i class="fa-solid fa-thumbs-up"></i> Ø¥Ø¹Ø¬Ø§Ø¨
            </button>
            <span id="likeCount" style="color: #65676b; font-size: 15px;">ÙŠÙØ­Ù…Ù‘Ù„...</span>
        </div>

        <div class="comments-section">
            <h3 style="font-size: 18px; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
            
            <div class="comment-input-area">
                <input type="text" id="commentText" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ..." />
                <button onclick="addComment()">Ù†Ø´Ø±</button>
            </div>

            <div id="commentsList">
                <p style="color:gray;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª...</p>
            </div>
             <p id="statusMessage" style="color: blue; margin-top: 10px;">Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        </div>
    </div>

    <script>
        // ğŸ”‘ 1. Ù…ÙØ§ØªÙŠØ­ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© (pavzwe6)
        const firebaseConfig = {
            apiKey: "AIzaSyDSCsM19ILK-5nVapzgTNEjW3_l1smrpJY",
            authDomain: "pavzwe6.firebaseapp.com",
            projectId: "pavzwe6",
            storageBucket: "pavzwe6.firebasestorage.app",
            messagingSenderId: "510449150820",
            appId: "1:510449150820:web:e05d51f2645e00cfeb6871",
            measurementId: "G-TTJHT37W4P"
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        const likeButton = document.getElementById('likeButton');
        const likeCount = document.getElementById('likeCount');
        const commentsList = document.getElementById('commentsList');
        const statusMessage = document.getElementById('statusMessage');
        const commentInput = document.getElementById('commentText');

        const postId = 'main_post_1'; // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ù…Ø´ØªØ±Ùƒ
        const localStorageKey = 'user_has_liked_' + postId;

        // ----------------------------------------------------
        // ğŸ”‘ 2. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
        // ----------------------------------------------------
        function startRealtimeLikes() {
            db.collection('posts').doc(postId).onSnapshot(doc => {
                if (doc.exists) {
                    const currentLikes = doc.data().likes || 0;
                    likeCount.innerText = `${currentLikes} Ø¥Ø¹Ø¬Ø§Ø¨`;
                    statusMessage.innerText = 'âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹.';
                } else {
                    db.collection('posts').doc(postId).set({ likes: 0 });
                    likeCount.innerText = `0 Ø¥Ø¹Ø¬Ø§Ø¨`;
                    statusMessage.innerText = 'âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†Ø´ÙˆØ± ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
                }
            }, error => {
                 statusMessage.innerText = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†.`;
            });
        }

        async function toggleLike() {
            const hasLiked = localStorage.getItem(localStorageKey) === 'true';
            
            return db.runTransaction(async (transaction) => {
                const postRef = db.collection('posts').doc(postId);
                const postDoc = await transaction.get(postRef);
                
                let newLikes = postDoc.data().likes;

                if (hasLiked) {
                    newLikes = Math.max(0, newLikes - 1);
                    likeButton.classList.remove('liked');
                    likeButton.innerHTML = '<i class="fa-solid fa-thumbs-up"></i> Ø¥Ø¹Ø¬Ø§Ø¨';
                    localStorage.setItem(localStorageKey, 'false');
                } else {
                    newLikes += 1;
                    likeButton.classList.add('liked');
                    likeButton.innerHTML = '<i class="fa-solid fa-thumbs-up"></i> ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨';
                    localStorage.setItem(localStorageKey, 'true');
                }
                
                transaction.update(postRef, { likes: newLikes });
            });
        }
        
        // ----------------------------------------------------
        // ğŸ”‘ 3. Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
        // ----------------------------------------------------

        function startRealtimeComments() {
            // ÙØ±Ø² Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ù„Ù„Ø£Ù‚Ø¯Ù…
            db.collection('comments').where('postId', '==', postId).orderBy('timestamp', 'desc').onSnapshot(snapshot => {
                renderComments(snapshot.docs);
            }, error => {
                 statusMessage.innerText = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†.`;
            });
        }

        async function addComment() {
            const text = commentInput.value.trim();
            const author = "Ø§Ù„Ù…ÙÙƒØ± Ù…ØµØ·ÙÙ‰";

            if (text) {
                try {
                    await db.collection('comments').add({
                        postId: postId,
                        author: author,
                        text: text,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    commentInput.value = '';
                } catch (e) {
                    statusMessage.innerText = 'âŒ ÙØ´Ù„ Ù†Ø´Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚.';
                }
            }
        }

        function renderComments(docs) {
            commentsList.innerHTML = '';
            if (docs.length === 0) {
                 commentsList.innerHTML = '<p style="color:gray;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯. ÙƒÙ† Ø£Ù†Øª Ø£ÙˆÙ„ Ù…Ø¹Ù„Ù‚!</p>';
                 return;
            }

            docs.forEach(doc => {
                const commentDiv = document.createElement('div');
                commentDiv.className = 'comment';
                const data = doc.data();
                commentDiv.innerHTML = `<span class="comment-author">${data.author}:</span> ${data.text}`;
                commentsList.appendChild(commentDiv);
            });
        }

        // ----------------------------------------------------
        // 4. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        // ----------------------------------------------------
        window.onload = () => {
            const hasLiked = localStorage.getItem(localStorageKey) === 'true';
            if (hasLiked) {
                likeButton.classList.add('liked');
                likeButton.innerHTML = '<i class="fa-solid fa-thumbs-up"></i> ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨';
            }
            
            startRealtimeLikes();
            startRealtimeComments();
        };

    </script>
</body>
</html>